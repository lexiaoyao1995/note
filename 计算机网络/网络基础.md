[toc]

# 基础

## osi七层模型

1、物理层   比特流

2、数据链路层  帧结构  交换机 

> rap协议
>
> 将ip解析为mac地址

3、网络层   

> * ip
>
> ​     由网络位和主机位组成
>
> 网络位：当前ip所在的网端，通过ipv4和子网掩码做与运算得到
>
> * route
>
> ​     路由表：指明当前ip需要路由的下一个ip

4、传输层   tcp   udp   分段

5、会话层   不同机器上的户用建立会话    数据

6、表示层   信息的语法

> 表示层和会话层主要功能是加密，包括对称加密和非对称加密等

7、应用层    http 

## TCP/IP概念层

1、链路层

2、网络层

3、传输层

4、应用层

## 在浏览器地址栏键入url后，按下回车后经历的流程

1、dns解析

2、tcp连接

3、发送http请求

4、服务器处理请求并返回http报文

5、浏览器解析渲染页面

6、连接结束

# 网络一致性

## 拜占庭将军问题

在打仗的时候，拜占庭军队内所有将军必需达成**一致的共识**，才能更好地赢得胜利。但是，在军队内有可能存有叛徒，扰乱将军们的决定。

这时候，在已知有成员不可靠的情况下，其余忠诚的将军需要在不受叛徒或间谍的影响下达成一致的协议。

莱斯利·兰伯特（ Leslie Lamport ）通过这个比喻，表达了计算机网络中所存在的一致性问题。这个问题被称为**拜占庭将军问题**。

## Raft协议

Raft 算法是一种简单易懂的共识算法。它依靠 **状态机** 和 **主从同步** 的方式，在各个节点之间实现数据的一致性。

在学习Raft算法的时候，大家需要了解Raft的两个核心要点：

**1.选取主节点**

**2.同步数据**

#### 选取主节点

Raft算法为节点定义了三种角色：

**1.Leader**（主节点）

**2.Follower**（从节点）

**3.Candidate**（参与投票竞争的节点）

让我们来看一看选主的具体流程：

**第一步**，在最初，还没有一个主节点的时候，所有节点的身份都是Follower。每一个节点都有自己的计时器，当计时达到了超时时间（Election Timeout），该节点会转变为Candidate。

**第二步**，成为Candidate的节点，会首先给自己投票，然后向集群中其他所有的节点发起请求，要求大家都给自己投票。

**第三步**，其他收到投票请求且还未投票的Follower节点会向发起者投票，发起者收到反馈通知后，票数增加。

**第四步**，当得票数超过了集群节点数量的一半，该节点晋升为Leader节点。Leader节点会立刻向其他节点发出通知，告诉大家自己才是老大。收到通知的节点全部变为Follower，并且各自的计时器清零。

每个节点的超时时间都是不一样的。比如A节点的超时时间是3秒，B节点的超时时间是5秒，C节点的超时时间是4秒。这样一来，A节点将会最先发起投票请求，而不是所有节点同时发起。

为什么这样设计呢？设想如果所有节点同时发起投票，必然会导致大家的票数差不多，形成僵局，谁也当不成老大。

那么，成为Leader的节点是否就坐稳了老大的位置呢？并不是。Leader节点需要每隔一段时间向集群其他节点发送心跳通知，表明你们的老大还活着。

#### 同步数据

**第一步**，由客户端提交数据到Leader节点。

**第二步**，由Leader节点把数据复制到集群内所有的Follower节点。如果一次复制失败，会不断进行重试。

**第三步**，Follower节点们接收到复制的数据，会反馈给Leader节点。

**第四步**，如果Leader节点接收到超过半数的Follower反馈，表明复制成功。于是提交自己的数据，并通知客户端数据提交成功。

**第五步**，由Leader节点通知集群内所有的Follower节点提交数据，从而完成数据同步流程。

# DNS

DNS是应用层协议，事实上他是为其他应用层协议工作的，包括不限于HTTP和SMTP以及FTP，用于将用户提供的主机名解析为ip地址。

## DNS过程

关于DNS的获取流程：
DNS是应用层协议，事实上他是为其他应用层协议工作的，包括不限于HTTP和SMTP以及FTP，用于将用户提供的主机名解析为ip地址。
具体过程如下：
①用户主机上运行着DNS的客户端，就是我们的PC机或者手机客户端运行着DNS客户端了
②浏览器将接收到的url中抽取出域名字段，就是访问的主机名，比如

```text
http://www.baidu.com/
```

, 并将这个主机名传送给DNS应用的客户端
③DNS客户机端向DNS服务器端发送一份查询报文，报文中包含着要访问的主机名字段（中间包括一些列缓存查询以及分布式DNS集群的工作）
④该DNS客户机最终会收到一份回答报文，其中包含有该主机名对应的IP地址
⑤一旦该浏览器收到来自DNS的IP地址，就可以向该IP地址定位的HTTP服务器发起TCP连接

# CDN

**全称**:Content Delivery Network或Content Ddistribute Network，即内容分发网络

### **基本思路**：

尽可能避开互联网上有可能影响数据传输速度和稳定性的瓶颈和环节，使内容传输的更快、更稳定。通过在网络各处放置节点服务器所构成的在现有的互联网基础之上的一层智能虚拟网络，CDN系统能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点上。

### **基础架构：**

最简单的CDN网络由一个DNS服务器和几台缓存服务器组成：

1. 当用户点击网站页面上的内容URL，经过本地DNS系统解析，DNS系统会最终将域名的解析权交给CNAME指向的CDN专用DNS服务器。
2. CDN的DNS服务器将CDN的全局负载均衡设备IP地址返回用户。
3. 用户向CDN的全局负载均衡设备发起内容URL访问请求。
4. CDN全局负载均衡设备根据用户IP地址，以及用户请求的内容URL，选择一台用户所属区域的区域负载均衡设备，告诉用户向这台设备发起请求。
5. 区域负载均衡设备会为用户选择一台合适的缓存服务器提供服务，选择的依据包括：根据用户IP地址，判断哪一台服务器距用户最近；根据用户所请求的URL中携带的内容名称，判断哪一台服务器上有用户所需内容；查询各个服务器当前的负载情况，判断哪一台服务器尚有服务能力。基于以上这些条件的综合分析之后，区域负载均衡设备会向全局负载均衡设备返回一台缓存服务器的IP地址。
6. 全局负载均衡设备把服务器的IP地址返回给用户。
7. 用户向缓存服务器发起请求，缓存服务器响应用户请求，将用户所需内容传送到用户终端。如果这台缓存服务器上并没有用户想要的内容，而区域均衡设备依然将它分配给了用户，那么这台服务器就要向它的上一级缓存服务器请求内容，直至追溯到网站的源服务器将内容拉到本地。

### **主要特点：**

1、本地Cache加速，提高了企业站点（尤其含有大量图片和静态页面站点）的访问速度，并大大提高以上性质站点的稳定性

2、镜像服务消除了不同运营商之间互联的瓶颈造成的影响，实现了跨运营商的网络加速，保证不同网络中的用户都能得到良好的访问质量。

3、远程加速 远程访问用户根据DNS负载均衡技术 智能自动选择Cache服务器，选择最快的Cache服务器，加快远程访问的速度

4、带宽优化 自动生成服务器的远程Mirror（镜像）cache服务器，远程用户访问时从cache服务器上读取数据，减少远程访问的带宽、分担网络流量、减轻原站点WEB服务器负载等功能。

5、集群抗攻击 广泛分布的CDN节点加上节点之间的智能冗余机制，可以有效地预防黑客入侵以及降低各种D.D.o.S攻击对网站的影响，同时保证较好的服务质量 。

### **关键技术：**

内容发布：它借助于建立索引、缓存、流分裂、组播（Multicast）等技术

内容路由：它是整体性的网络负载均衡技术，通过内容路由器中的重定向（DNS）机制，在多个远程POP上均衡用户的请求，以使用户请求得到最近内容源的响应；

内容交换：它根据内容的可用性、服务器的可用性以及用户的背景，在POP的缓存服务器上，利用应用层交换、流分裂、重定向（ICP、WCCP）等技术，智能地平衡负载流量；

性能管理：它通过内部和外部监控系统，获取网络部件的状况信息，测量内容发布的端到端性能（如包丢失、延时、平均带宽、启动时间、帧速率等），保证网络处于最佳的运行状态。

### **Q & A**

**1.CDN加速是对网站所在服务器加速，还是对其域名加速？**

CDN是只对网站的某一个具体的域名加速。如果同一个网站有多个域名，则访客访问加入CDN的域名获得加速效果，访问未加入CDN的域名，或者直接访问IP地址，则无法获得CDN效果。

**2.CDN和镜像站点比较有何优势？**　　

CDN对网站的访客完全透明，不需要访客手动选择要访问的镜像站点，保证了网站对访客的友好性。　　CDN对每个节点都有可用性检查，不合格的节点会第一时间剔出，从而保证了极高的可用率，而镜像站点无法实现这一点。　　CDN部署简单，对原站基本不做任何改动即可生效。

**3.CDN和双线机房相比有何优势？**

常见的双线机房只能解决网通和电信互相访问慢的问题，其它ISP（譬如教育网，移动网，铁通）互通的问题还是没得到解决。　　而CDN是访问者就近取数据，而CDN的节点遍布各ISP，从而保证了网站到任意ISP的访问速度。另外CDN因为其流量分流到各节点的原理，天然获得抵抗网络攻击的能力。

**4.CDN使用后，原来的网站是否需要做修改，做什么修改？**

一般而言，网站无需任何修改即可使用CDN获得加速效果。只是对需要判断访客IP程序，才需要做少量修改。

**5.为什么我的网站更新后，通过CDN后看到网页还是旧网页，如何解决？**　　

由于CDN采用各节点缓存的机制，网站的静态网页和图片修改后，如果CDN缓存没有做相应更新，则看到的还是旧的网页。为了解决这个问题，CDN管理面板中提供了URL推送服务，来通知CDN各节点刷新自己的缓存。　　在URL推送地址栏中，输入具体的网址或者图片地址，则各节点中的缓存内容即被统一删除，并且当即生效。　　如果需要推送的网址和图片太多，可以选择目录推送，输入 http://www.kkk.com/news 即可以对网站下news目录下所有网页和图片进行了刷新。

**6.能不能让CDN不缓存某些即时性要求很高的网页和图片？**

只需要使用动态页面，asp，php，jsp等动态技术做成的页面不被CDN缓存，无需每次都要刷新。或者采用一个网站两个域名，一个启用CDN，另外一个域名不用CDN，对即时性要求高的页面和图片放在不用CDN的域名下。

**7.网站新增了不少网页和图片，这些需要使用URL推送吗？**　　

后来增加的网页和图片，不需要使用URL推送，因为它们本来就不存在缓存中。

**8.网站用CDN后，有些地区反映无法访问了，怎么办？**

CDN启用后，访客不能访问网站有很多种可能，可能是CDN的问题，也可能是源站点出现故障或者源站点被关闭，还可能是访客自己所在的网络出现问题，甚至我们实际故障排除中，还出现过客户自己计算机中毒，导致无法访问网站。　　客户报告故障时，可随时联系我们24小时技术部进行处理。

# 负载均衡

https://www.cnblogs.com/snidget/articles/12673461.html

# 面试题

### 127.0.0.1 和 0.0.0.0 和 本地ip

**127.0.0.1**

localhost是本地DNS解析的[127.0.0.1](https://www.baidu.com/s?wd=127.0.0.1&tn=44039180_cpr&fenlei=mv6quAkxTZn0IZRqIHckPjm4nH00T1dWP1N-PhR1rAP9nhPhn1uW0ZwV5Hcvrjm3rH6sPfKWUMw85HfYnjn4nH6sgvPsT6KdThsqpZwYTjCEQLGCpyw9Uz4Bmy-bIi4WUvYETgN-TLwGUv3EnHDLPWDznjTLrH0drjcvrjc4rf)的域名，在hosts文件里可以看到。

**0.0.0.0**

如果我们**直接ping 0.0.0.0**是不行的，他在IPV4中表示的是无效的目标地址，但是在服务器端它表示本机上的所有IPV4地址

在路由中，0.0.0.0表示的是**默认路由**，即当路由表中没有找到完全匹配的路由的时候所对应的路由。

**本地**ip

我们监听的是IP的话那么只有通过监听的IP才可以访问我们的对应的服务。